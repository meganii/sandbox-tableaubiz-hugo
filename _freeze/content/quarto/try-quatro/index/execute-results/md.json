{
  "hash": "49ca97c47a0c90088b9a235f901fb670",
  "result": {
    "markdown": "---\ntitle: Hello, Quarto\ndate: \"2023-12-02\"\nformat: hugo-md\nexecute:\n  freeze: true\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nif (!require(\"pacman\")) install.packages(\"pacman\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: pacman\n```\n:::\n\n```{.r .cell-code}\npacman::p_load(\n  jmastats,\n  tidyverse,\n  units,\n  patchwork\n)\ntheme_set(theme_bw()) # ggplot2のテーマ指定\n\nstations |>\n  filter(station_name == \"東京\") |>\n  distinct(block_no)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 1\n  block_no\n  <chr>   \n1 47662   \n```\n:::\n\n```{.r .cell-code}\ndf_tksm <-\n  # year引数に与えられる年を指定 ... 1923年から2022年まで\n  seq.int(1923, 2023) |>\n  purrr::set_names() |>\n  purrr::map(\n    \\(x) jma_collect(item = \"daily\",\n                     block_no = \"47662\",\n                     year = x,\n                     month = 7)) |>\n  # 一つのデータフレームにまとめる\n  # 取得を行った年をyear変数に記録する\n  purrr::list_rbind(names_to = \"year\")\n\n\nglimpse(df_tksm)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 3,131\nColumns: 10\n$ year          <chr> \"1923\", \"1923\", \"1923\", \"1923\", \"1923\", \"1923\", \"1923\", …\n$ date          <date> 1923-07-01, 1923-07-02, 1923-07-03, 1923-07-04, 1923-07…\n$ pressure      <tibble[,2]> <tbl_df[26 x 2]>\n$ precipitation <tibble[,3]> <tbl_df[26 x 3]>\n$ temperature   <tibble[,3]> <tbl_df[26 x 3]>\n$ humidity      <tibble[,2]> <tbl_df[26 x 2]>\n$ wind          <tibble[,5]> <tbl_df[26 x 5]>\n$ sunshine      <tibble[,1]> <tbl_df[26 x 1]>\n$ snow          <tibble[,2]> <tbl_df[26 x 2]>\n$ weather_time  <tibble[,2]> <tbl_df[26 x 2]>\n```\n:::\n\n```{.r .cell-code}\ndf_tksm <-\n  df_tksm |>\n  # 日付と気温についての変数を選択\n  select(year,\n         date,\n         temperature) |>\n  # ネストされたデータフレームを展開する\n  tidyr::unnest(cols = temperature)\n\nglimpse(df_tksm)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 3,131\nColumns: 5\n$ year         <chr> \"1923\", \"1923\", \"1923\", \"1923\", \"1923\", \"1923\", \"1923\", \"…\n$ date         <date> 1923-07-01, 1923-07-02, 1923-07-03, 1923-07-04, 1923-07-…\n$ `average(℃)` <dbl> 20.0, 20.0, 19.9, 22.4, 21.0, 19.2, 18.5, 19.5, 22.2, 23.…\n$ `max(℃)`     <dbl> 22.1, 23.2, 23.8, 27.9, 23.4, 24.9, 21.6, 23.6, 26.8, 27.…\n$ `min(℃)`     <dbl> 18.5, 18.0, 17.0, 16.2, 17.3, 15.4, 15.8, 14.7, 19.7, 20.…\n```\n:::\n\n```{.r .cell-code}\ndf_tksm <-\n  df_tksm |>\n  #　変数名から単位を取り除き、変数の値を対応するunitsオブジェクトに変換\n  parse_unit()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nNew names:\n• `` -> `...1`\n• `` -> `...2`\n• `` -> `...3`\n```\n:::\n\n```{.r .cell-code}\nglimpse(df_tksm)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 3,131\nColumns: 5\n$ year    <chr> \"1923\", \"1923\", \"1923\", \"1923\", \"1923\", \"1923\", \"1923\", \"1923\"…\n$ date    <date> 1923-07-01, 1923-07-02, 1923-07-03, 1923-07-04, 1923-07-05, 1…\n$ average [°C] 20.0 [°C], 20.0 [°C], 19.9 [°C], 22.4 [°C], 21.0 [°C], 19.2 [°C…\n$ max     [°C] 22.1 [°C], 23.2 [°C], 23.8 [°C], 27.9 [°C], 23.4 [°C], 24.9 [°C…\n$ min     [°C] 18.5 [°C], 18.0 [°C], 17.0 [°C], 16.2 [°C], 17.3 [°C], 15.4 [°C…\n```\n:::\n\n```{.r .cell-code}\ndf_tksm <- \n  df_tksm |>\n  mutate(year = as.integer(year),\n         day = lubridate::day(date))\n\nplot_temp_hm <- function(data, var, ...) {\n  pal_relative <-\n    jmastats:::jma_pal(palette = \"relative\", .attribute = TRUE)\n  data |>\n    mutate(year = forcats::fct_rev(as.character(year)),\n           {{ var }} := drop_units({{ var }})) |>\n    mutate(z = case_when(\n      {{ var }} >= 35 ~ \"35~\",\n      between({{ var }}, 30, 35) ~ \"30~35\",\n      between({{ var }}, 25, 30) ~ \"25~30\",\n      between({{ var }}, 20, 25) ~ \"20~25\",\n      between({{ var }}, 15, 20) ~ \"15~20\",\n      between({{ var }}, 10, 15) ~ \"10~15\",\n      between({{ var }},  5, 10) ~ \"5~10\",\n      between({{ var }},  0,  5) ~ \"0~5\",\n      between({{ var }}, -5,  0) ~ \"-5~0\",\n      .default = as.character({{ var }})\n    )) |>\n    ggplot() +\n    aes(day, y = year, fill = z) +\n    geom_tile(color = \"white\", linewidth = 0.05, ...) +\n    coord_equal() +\n    scale_fill_manual(values = rev(pal_relative$colors |>\n                                     purrr::set_names(pal_relative$amedas$labels)),\n                      drop = TRUE) +\n    scale_y_discrete(breaks = as.character(seq.int(1920, 2020, by = 10))) +\n    guides(fill = guide_legend(title = NULL,\n                               reverse = TRUE))\n}\n\np1_ave <- \n  plot_temp_hm(df_tksm, average, show.legend = TRUE)\n\np1_ave +\n  labs(title = \"「東京」の7月の気温\",\n       subtitle = str_glue(\"平均気温({intToUtf8(c(176, 67))})\"),\n       caption = \"1923年から2022年の7月の各日の観測値\\nデータ源: 気象庁\")\n```\n\n::: {.cell-output-display}\n![](index.markdown_strict_files/figure-markdown_strict/unnamed-chunk-1-1.png){width=768}\n:::\n\n```{.r .cell-code}\np1_ave <- \n  plot_temp_hm(df_tksm, average, show.legend = FALSE) +\n  labs(subtitle = str_glue(\"平均気温({intToUtf8(c(176, 67))})\"))\np2_max <-\n  plot_temp_hm(df_tksm, max, show.legend = FALSE) +\n  labs(subtitle = str_glue(\"最高気温({intToUtf8(c(176, 67))})\"))\np3_min <-\n  plot_temp_hm(df_tksm, min, show.legend = FALSE) +\n  labs(subtitle = str_glue(\"最低気温({intToUtf8(c(176, 67))})\"))\n\n\npal_relative <-\n  jmastats:::jma_pal(palette = \"relative\", .attribute = TRUE)\n\np_legend <-\n  df_tksm |>\n  tidyr::pivot_longer(cols = c(average, min, max)) |>\n  mutate(value = drop_units(value)) |>\n  mutate(z = case_when(\n    value >= 35 ~ \"35~\",\n    between(value, 30, 35) ~ \"30~35\",\n    between(value, 25, 30) ~ \"25~30\",\n    between(value, 20, 25) ~ \"20~25\",\n    between(value, 15, 20) ~ \"15~20\",\n    between(value, 10, 15) ~ \"10~15\",\n    between(value,  5, 10) ~ \"05~10\",\n    between(value,  0,  5) ~ \"00~05\",\n    between(value, -5,  0) ~ \"-5~00\",\n    .default = as.character(value)\n  )) |>\n  filter(!is.na(z)) |>\n  ggplot() +\n  aes(day, value, fill = z) +\n  geom_tile() +\n  scale_fill_manual(values = rev(pal_relative$colors |>\n                                   purrr::set_names(pal_relative$amedas$labels)),\n                    drop = TRUE) +\n  guides(fill = guide_legend(title = NULL,\n                             reverse = TRUE))\n\np_legend <- cowplot::get_legend(p_legend)\n\n\np1_ave + p2_max + p3_min +\n  p_legend +\n  plot_layout(widths = c(0.3, 0.3, 0.3, 0.1), ncol = 4, guides = \"auto\") +\n  plot_annotation(title = \"「東京」の7月の気温\",\n                  caption = \"1923年から2022年の7月の各日の観測値\\nデータ源: 気象庁\")\n```\n\n::: {.cell-output-display}\n![](index.markdown_strict_files/figure-markdown_strict/unnamed-chunk-1-2.png){width=768}\n:::\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}